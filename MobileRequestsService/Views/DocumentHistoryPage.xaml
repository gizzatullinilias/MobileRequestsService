<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MobileRequestsService.Views.DocumentHistoryPage"
             Title="История заявок">

    <RefreshView IsRefreshing="{Binding IsLoading}"
                 Command="{Binding LoadHistoryCommand}">
        <ScrollView>
            <StackLayout Padding="10" Spacing="10">

                <ActivityIndicator IsRunning="{Binding IsLoading}" 
                                  IsVisible="{Binding IsLoading}" />

                <Label Text="{Binding ErrorMessage}" 
                       TextColor="Red"
                       IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}" />


                <ListView ItemsSource="{Binding Orders}"
                          HasUnevenRows="True"
                          SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell>
                                <Frame Padding="10" Margin="0,5">
                                    <StackLayout>
                                        <Label Text="{Binding DocumentType}" FontAttributes="Bold"/>
                                        <Label Text="{Binding Department, StringFormat='Отдел: {0}'}"/>
                                        <Label Text="{Binding Quantity, StringFormat='Количество: {0}'}"/>
                                        <Label Text="{Binding OrderStatus, StringFormat='Статус: {0}'}"/>
                                        <Label Text="{Binding CreatedAt, StringFormat='Дата создания: {0:dd.MM.yyyy HH:mm}'}"/>
                                    </StackLayout>
                                </Frame>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Пагинация -->
                <Grid Margin="0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Text="Назад" 
                            Command="{Binding PrevPageCommand}"
                            IsEnabled="{Binding CanNavigatePrev}"
                            Grid.Column="0"/>

                    <Button Text="Вперед" 
                            Command="{Binding NextPageCommand}"
                            IsEnabled="{Binding CanNavigateNext}"
                            Grid.Column="1"/>
                </Grid>

            </StackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>